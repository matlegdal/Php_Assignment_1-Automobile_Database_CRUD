<!DOCTYPE html>
<html>
<head>
<title>Assignment: Automobile Database CRUD</title>
<style>
li { padding: 5px; }
pre {padding-left: 2em;}
</style>
</head>
<body style="margin-left:5%; margin-bottom: 60px; margin-right: 5%; font-family: sans-serif;">
<h1>Assignment: Automobile Database CRUD</h1>
<p>
In this assignment you will build a web based application to
track data about automobiles.
We will only allow logged in users
to track automobiles.
</p>
<h1>Resources</h1>
<p>There are several resources you might find useful:
<ul>
<li>Recorded lectures, sample code and chapters from
<a href="http://www.wa4e.com" target="_blank">www.wa4e.com</a>:
<ul>
<li class="toplevel">
Understanding CRUD
</li>
</ul>
<li>
The sample code from the CRUD lecture is a simple working CRUD application.
<pre><a href="http://www.wa4e.com/code/crud.zip" target="_blank">http://www.wa4e.com/code/crud.zip</a>
</pre>
</li>
</ul>
<h2 clear="all">General Specifications</h2>
<p>
Here are some general specifications for this assignment:
<ul>
<li>
Your name must be in the title tag of the HTML for all of the pages
for this assignment.
</li>
<li>
All data that comes from the users must be properly escaped
using the <b>htmlentities()</b> function in PHP.  You do not
need to escape text that is generated by your program.
</li>
<li>
You must follow the POST-Redirect-GET pattern for all POST requests.
This means when your program receives and processes a POST request,
it must not generate any HTML as the HTTP response to that request.
It must use the "header('Location: ...');" function and "return"
to send the location header and redirect the browser
to the same or a different page.
</li>
<li>
Please do not use HTML5 in-browser data
validation (i.e. type="number") for the fields
in this assignment as we want to make sure you can properly do server
side data validation.  And in general, even when you do client-side
data validation, you should still validate data on the server in case
the user is using a non-HTML5 browser.
</li>
</ul>
<h2>Sample Implementation</h2>
<p>
You can experiment with a reference implementation at:
</p>
<p>
<a href="http://www.wa4e.com/solutions/autoscrud" target="_blank">http://www.wa4e.com/solutions/autoscrud</a>
</p>
<h2>Using the Autograder</h2>
<p>
This assignment will be automatically graded and so your web server will need an 
Internet-accessible URL so you can submit it for autograding.  To achieve this
you will need to install and use a piece of software called "ngrok".  Instructions
for installing and using ngrok are available at:
</p>
<p>
<a href="http://www.wa4e.com/ngrok.php" target="_blank">http://www.wa4e.com/ngrok.php</a>
</p>
<p>
Please see the process for handing in the assignment at the end of this document.
</p>
<p>
<b>Important:</b> The autograder will demand that your name is in the &lt;title&gt;
tag in the head are of your document.  If the autograder does not find your name,
it will run all the tests but will not treat the grade as official.
</p>
<h2>Creating Automobile table</h2>
<p>
You can reuse or adapt a table from a previous assignment.   This assignment
will need a table as follows:
<pre>    CREATE TABLE autos (
        autos_id INTEGER NOT NULL KEY AUTO_INCREMENT,
        make VARCHAR(255),
        model VARCHAR(255),
        year INTEGER,
        mileage INTEGER
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</pre>

<h2>Protecting the add.php and edit.php</h2>
<p>
In order to protect the database from being modified without the user properly
logging in, the <b >add.php</b> and <b>edit.php</b> must first check the session to see
if the user's name is set and if the user's name is not set in the session
the they must stop immediately using the PHP die() function:
<pre>    die("ACCESS DENIED");
</pre>
To test, navigate to <b>add.php</b> manually without logging in - it
should fail with "ACCESS DENIED".
</p>
<h2>Log in</h2>
<p>
If the user is not logged in, they will be presented a screen with a welcome 
and a link to <b>login.php</b> - they should not see the table of data.
<div style="border: 2px solid black; padding: 10px;">
<h2>Welcome to the Automobiles Database</h2>
<p><span style="color:blue; text-decoration: underline;">Please log in</span></p>
</div>
<p>
<a href="01-Login.png" target="_blank">
<img style="margin-left: 10px; float:right;"
alt="Image of the login screen"
width="300px" src="../crud_generic/01-Login.png" border="2"/>
</a>
<p>
<p>
The autograder will log in to your program with the following account 
and password:
<pre>Account: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="53263e203a13263e3a303b7d363726">[email&#160;protected]</a>
Password: php123
</pre>
<p>
The login screen needs to have some error checking on its input
data.  If either the name or the password field is blank, you should
display a message of the form:
<pre style="color:red">    User name and password are required
</pre>
If the password is non-blank and incorrect, you should put up a message
of the form:
<pre style="color:red">    Incorrect password
</pre>
<p>
<b>Note:</b> Please name your form fields in <b>login.php</b> exactly 
as follows for autograding:
<pre>User Name &lt;input type="text" name="email"&gt;&lt;br/&gt;
Password &lt;input type="text" name="pass"&gt;&lt;br/&gt;
</pre>

<h2>Automobile Database Main List</h2>
<p>
Once the user is logged in, they should should be redirected to <b>index.php</b>
where they will be shown see a list of
the automobiles in the database in a table similar to the
following:
<div style="border: 2px solid black; padding: 10px;">
<h2>Welcome to the Automobiles Database</h2>
<table border="1">
<thead><tr>
<th>Make</th>
<th>Model</th>
<th>Year</th>
<th>Mileage</th>
<th>Action</th>
</tr></thead>
<tr><td>Deviators</td><td>Irisated</td><td>83</td><td>40</td><td><span style="color:blue; text-decoration: underline;">Edit</span> / <span style="color:blue; text-decoration: underline;">Delete</span></td>
</tr>
<tr><td>Immerging</td><td>Unbroke</td><td>86</td><td>87</td><td><span style="color:blue; text-decoration: underline;">Edit</span> / <span style="color:blue; text-decoration: underline;">Delete</span></td>
</tr>
<tr><td>Forever</td><td>Woggle</td><td>20</td><td>65</td><td><span style="color:blue; text-decoration: underline;">Edit</span> / <span style="color:blue; text-decoration: underline;">Delete</span></td>
</tr>
<tr><td>Comedietta</td><td>Chiles</td><td>21</td><td>69</td><td><span style="color:blue; text-decoration: underline;">Edit</span> / <span style="color:blue; text-decoration: underline;">Delete</span></td>
</tr>
</table>
</p>
<p><span style="color:blue; text-decoration: underline;">Add New Entry</span></p>
<p><span style="color:blue; text-decoration: underline;">Logout</span></p>
</div>
<p>
If there are no rows in the table, do not print out the table, but simply
print out <b>"No rows found"</b>.
</p>
<p>
There should also be options to <b>Add a New Entry</b> and <b>Log Out</b> 
presented after the table.
</p>
<p>
If the <b>Logout link</b> is pressed the user should be sent to the
<b>logout.php</b> page which clears session variables and redirects
back to <b>index.php</b>.
</p>
<h2>Adding new Records</h2>
<p>
When the user asks to add a new record, they should be presented with a
screen that allows them to append a new automobile.
Each automobile will have the following fields:
<ul>
<li>
Make
</li>
<li>
Model
</li>
<li>
Year
 - must be an integer - use is_numeric() to validate </li>
<li>
Mileage
 - must be an integer - use is_numeric() to validate </li>
</ul>
<b>Important:</b> Make sure to name the fields in your forms using the lower case version 
of the field names so that the autograder can work:
<pre>  &lt;input type="text" name="make"&gt;
</pre>
</p>
<p>When processing an incoming POST, data must be validated.
All fields are required, if there is a missing (i.e. blank) field,
issue a message like:
<pre style="color: red;">    All fields are required
</pre>
</p>

<p>If the user enters a non-numeric field, you should issue a message like:
<pre style="color: red;">    Year must be an integer
</pre>
</p><p>
If there are any errors on the input, do not add the record to the stored data.
Redirect the user back to the <b>add.php</b> script and display the error message
"flash style".
<pre>    if ( ... at least one of the fields is empty ... ) {
        $_SESSION['error'] = "All fields are required";
        header("Location: add.php");
        return;
    }

...

    if ( isset($_SESSION['error']) ) {
        echo('&lt;p style="color: red;"&gt;'.htmlentities($_SESSION['error'])."&lt;/p&gt;\n");
        unset($_SESSION['error']);
    }
</pre>
<p>
Note that only one of the error messages need to come out regardless of
how many errors the user makes in their input data.  Once you detect one
error in the input data, you can stop checking for further errors.
</p>
<p>
If the data validates and the add is successful, redirect to <b>index.php</b> with a 
successful flash message:
<pre></pre>
<pre style="color: green;">   Record added
</pre>

<h2>Editing Records and Validation Errors</h2>
<p>
When you edit a record, the prior data must be shown and properly escaped.  All of the 
data validation must be performed on the edit data as required in the <b>add.php</b>.
Make sure to include the "id" parameter (you may name this variable differently) on 
the redirect statement in the <b>edit.php</b> when an error is detected:
<pre>    if ( ... a field is missing ... ) {
        $_SESSION['error'] = "All fields are required";
        header("Location: edit.php?autos_id=".$_REQUEST['id']);
        return;
    }
</pre>
If the data validates and the edit is successful, redirect to <b>index.php</b> with a 
successful flash message:
<pre></pre>
<pre style="color: green;">   Record edited
</pre>
<h2>Deleteing Records</h2>
<p>
When the user selects the "Delete" link from the list of 
Automobiles you should put up a form with "Delete" and
"Cancel" options.  
</p>
<img src="../crud_generic/02-Delete.png" border="2">
<p>
If the "Delete" button is pressed, the record 
is deleted and the user is redirected to <b>index.php</b> with a success message:
<pre style="color: green;">   Record deleted
</pre>

